<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CareerAI — Fraud Detection</title>
  <!-- Tailwind CDN for quick styling -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* small custom tweaks for a clean, elegant look */
    body { background: linear-gradient(180deg, #f8fafc 0%, #ffffff 100%); }
    .glass { background: rgba(255,255,255,0.8); backdrop-filter: blur(6px); }
    .muted { color: #6b7280; }
    .shadow-soft { box-shadow: 0 6px 18px rgba(15,23,42,0.06); }
    label { font-size: 0.9rem; }
    input[type=number]::-webkit-outer-spin-button, input[type=number]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
  </style>
</head>
<body class="min-h-screen flex flex-col bg-gradient-to-br from-indigo-50 via-white to-blue-50">
  <nav class="w-full bg-white/80 backdrop-blur-md shadow-soft px-6 py-4 flex items-center justify-between sticky top-0 z-20">
      <h1 class="text-xl font-semibold text-indigo-700">Fraud Detection Dashboard</h1>
      <ul class="flex space-x-6 text-sm text-indigo-600">
        <li><a href="#" class="hover:text-indigo-800">Home</a></li>
        <li><a href="#" class="hover:text-indigo-800">Model</a></li>
        <li><a href="#" class="hover:text-indigo-800">About</a></li>
      </ul>
    </nav>

    <main class="max-w-5xl w-full grid grid-cols-1 lg:grid-cols-3 gap-8">
    <!-- Left: Intro -->
    <section class="lg:col-span-1 glass p-6 rounded-2xl shadow-soft">
      <h1 class="text-2xl font-semibold">Fraud Detection</h1>
      <p class="muted mt-3">Enter transaction data and get an AI-powered fraud score instantly. Built with a Random Forest model — production-ready and fast.</p>

      <div class="mt-6 border-t pt-4">
        <h2 class="text-sm font-medium muted">How to use</h2>
        <ol class="mt-2 text-sm muted list-decimal list-inside space-y-2">
          <li>Fill the transaction fields (Time, Amount and V1–V28).</li>
          <li>Click <strong>Predict</strong> to call the local API.</li>
          <li>See probability and decision instantly.</li>
        </ol>
      </div>

      <div class="mt-6 text-xs muted">
        <p><strong>Note:</strong> For local testing, your FastAPI server must run at <code>http://127.0.0.1:8000</code>.</p>
      </div>
    </section>

    <!-- Right: Form -->
    <section class="lg:col-span-2 glass p-6 rounded-2xl shadow-soft">
      <form id="txForm" class="space-y-4">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div>
            <label class="block muted">Time</label>
            <input id="Time" type="number" step="1" value="1000" class="mt-1 w-full rounded-lg border px-3 py-2" />
          </div>
          <div>
            <label class="block muted">Amount</label>
            <input id="Amount" type="number" step="0.01" value="50" class="mt-1 w-full rounded-lg border px-3 py-2" />
          </div>
          <div>
            <label class="block muted">Threshold</label>
            <input id="threshold" type="number" step="0.01" value="0.5" min="0" max="1" class="mt-1 w-full rounded-lg border px-3 py-2" />
          </div>
        </div>

        <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mt-3">
          <!-- V1 - V28 inputs dynamically created by script if JS disabled, graceful fallback included -->
          <div class="col-span-4 text-sm muted">PCA features (V1 – V28)</div>
          <div id="vInputs" class="col-span-4 grid grid-cols-2 md:grid-cols-4 gap-3"></div>
        </div>

        <div class="flex items-center space-x-3 mt-4">
          <button id="predictBtn" type="button" class="bg-indigo-600 text-white px-5 py-2 rounded-lg hover:bg-indigo-700">Predict</button>
          <button id="resetBtn" type="button" class="border px-4 py-2 rounded-lg">Reset</button>

          <div id="spinner" class="ml-4 hidden text-sm muted">Calling model...</div>
        </div>

        <div id="resultCard" class="mt-6 p-4 rounded-lg border hidden">
          <h3 class="text-lg font-semibold" id="resultTitle">Result</h3>
          <p class="mt-2 muted">Probability: <span id="prob">—</span></p>
          <p class="mt-1 muted">Fraud: <span id="decision">—</span></p>
          <div id="advInfo" class="mt-3 text-sm muted"></div>
        </div>

      </form>

      <div class="mt-6 text-xs muted">Built by you • ML model served via FastAPI</div>
    </section>
  </main>

  <script>
    // Create V1..V28 inputs
    const vContainer = document.getElementById('vInputs');
    for (let i = 1; i <= 28; i++) {
      const id = 'V' + i;
      const wrapper = document.createElement('div');
      wrapper.className = 'flex flex-col';
      wrapper.innerHTML = `
        <label class="block text-sm muted">${id}</label>
        <input id="${id}" type="number" step="0.01" value="0" class="mt-1 w-full rounded-lg border px-2 py-2" />
      `;
      vContainer.appendChild(wrapper);
    }

    const predictBtn = document.getElementById('predictBtn');
    const resetBtn = document.getElementById('resetBtn');
    const spinner = document.getElementById('spinner');
    const resultCard = document.getElementById('resultCard');
    const probEl = document.getElementById('prob');
    const decisionEl = document.getElementById('decision');
    const advInfo = document.getElementById('advInfo');

    function getFormData() {
      const data = {};
      data.Time = Number(document.getElementById('Time').value || 0);
      data.Amount = Number(document.getElementById('Amount').value || 0);
      for (let i = 1; i <= 28; i++) {
        data['V' + i] = Number(document.getElementById('V' + i).value || 0);
      }
      return data;
    }

    function showSpinner(show) {
      spinner.classList.toggle('hidden', !show);
      predictBtn.disabled = show;
    }

    async function predict() {
      resultCard.classList.add('hidden');
      advInfo.textContent = '';
      const data = getFormData();
      const threshold = parseFloat(document.getElementById('threshold').value || '0.5');

      showSpinner(true);
      try {
        const res = await fetch('http://127.0.0.1:8000/predict', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });

        if (!res.ok) {
          const err = await res.json().catch(() => ({}));
          throw new Error(err.detail || ('HTTP ' + res.status));
        }

        const body = await res.json();
        const prob = Number(body.fraud_probability);
        const decision = prob >= threshold;

        probEl.textContent = prob.toFixed(4);
        decisionEl.textContent = decision ? 'Yes' : 'No';
        advInfo.innerHTML = `<div>Model prob: ${prob.toFixed(4)} • Threshold: ${threshold}</div>`;
        resultCard.classList.remove('hidden');

      } catch (err) {
        advInfo.textContent = 'Error: ' + err.message;
        resultCard.classList.remove('hidden');
      } finally {
        showSpinner(false);
      }
    }

    predictBtn.addEventListener('click', predict);
    resetBtn.addEventListener('click', () => {
      document.getElementById('Time').value = 1000;
      document.getElementById('Amount').value = 50;
      for (let i = 1; i <= 28; i++) document.getElementById('V' + i).value = 0;
      resultCard.classList.add('hidden');
      advInfo.textContent = '';
    });

    // If the UI is hosted elsewhere, change the fetch URL to full path, e.g. https://yourdomain.com/predict

  </script>
</body>
</html>
